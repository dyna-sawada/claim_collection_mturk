<head>
  <meta charset="utf-8">
  <!-- meta_name_viewport : スマホ対応 幅から計算 -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
</head>

<crowd-form answer-format="flatten-objects">
  <div class="container-fluid">
    <!--
    <h5><strong>Instruction</strong></h5>
    <p>
      Thank you for taking the time to help us!<br/> In this task, you will be presented with a original argument and a counter-argument in a debate.
      For the counter-argument, we would like for you to label each sentence as one of five types.
    </p>
    <p>
      <ul  class="mb-4">
        <li> <span style="color:#DF01A5;"><b>Stance</b></span>: statements that express agreement or disagreement with a topic </li>
        <li> <span style="color:#cd5c5c;"><b>Claim</b></span>: central reason given in support of the debater's stance ( In general, there is one claim, at most two claims per speech ) </li>
        <li> <span style="color:#3169B3;"><b>Reason</b></span>: additional reasons that underpin the plausibility of the claim </li>
        <li> <span style="color:#6CBB5A;"><b>Example</b></span>: personal experiences, hypothetical situations, statistics, and references in newspapers, etc. </li>
        <li> <span style="color:#F8960C;"><b>Other</b></span>: greetings at the beginning and end </li>
      </ul>
    </p>

    <h5><strong>How to label sentences</strong></h5>
    <p>
      <ol>
        <li>Select a sentence and press a button of the type you have determined</li>
        <li>If you choose <span style="color:#3169B3;"><b>Reason</b></span> and <span style="color:#6CBB5A;"><b>Example</b></span>, select the ID of a claim that they support</li>
      </ol>
    </p>
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-6 mb-4">
          <img class="img-responsive center-block" style="max-width: 90%; height: auto;" src="https://i.gyazo.com/8aa6b684e4031dccbc7384e3a224e0a0.jpg">
        </div>
        <div class="col-lg-6">
          <img class="img-responsive center-block" style="max-width: 90%; height: auto;" src="https://i.gyazo.com/40d02f9764269444c785f354a9efc073.jpg">
        </div>
      </div>
    </div>

    <h5><strong>Examples</strong></h5>
    <b>Original argument</b>
    <div class="pm-speech mb-3">
      Hello everyone. Today’s topic is “Homework should be abolished”.
      We have two points: The first point is “free time” and the second point is “decrease burden on teachers”.
      I will explain the first point of “free time”.
      We believe that if homework were to be abolished, we could have more free time.
      As a result, we could do more of what we really wanted like club activities, hobbies, or playing with friends.
      In my case, I go to tennis club after class until 5:00 pm and then I go to cram school until 8:00 pm.
      After this full day, I arrive at my home around 8:40 pm to eat dinner and take a shower.
      At nearly 10:00 pm I start my homework.
      I have a lot of homework.
      As a result, I go to bed late at night at nearly 1:00 am in the morning and I don’t have the opportunity to sleep for a long period of time.
      It is not healthy.
      Therefore, homework should be abolished.
      Thank you.
    </div>

    <div class="mb-3">
      <ul>
        <li> <span style="color:#DF01A5;"><b>Stance</b></span>: statements that express agreement or disagreement with a topic
        <li> <span style="color:#cd5c5c;"><b>Claim</b></span>: central reason given in support of the debater's stance ( In general, there is one claim, at most two claims per speech )
        <li> <span style="color:#3169B3;"><b>Reason</b></span>: additional reasons that underpin the plausibility of the claim
        <li> <span style="color:#6CBB5A;"><b>Example</b></span>: personal experiences, hypothetical situations, statistics, and references in newspapers, etc.
        <li> <span style="color:#F8960C;"><b>Other</b></span>: greetings at the beginning and end
      </ul>
    </div>

    <b>Counter-argument 1</b>
    <div class="pm-speech">
      They said that by abolishing homework, we can enjoy more free time.
      <span style="color:#cd5c5c;"><b>However, it's not true. Even if enjoying free more time is necessary, we can do so by alternative way such as using out time more efficiently.</b></span>
      <span style="color:#3169B3;"><b>Because we can reduce time taken to do homework.</b></span>
      <span style="color:#6CBB5A;"><b>For example, we can use the break between classes or time before homeroom.</b></span>
      <span style="color:#3169B3;"><b>Moreover, we can do homework with friends during playing with them.</b></span>
      <span style="color:#DF01A5;"><b>Therefore, homework should not be abolished.</b></span>
      <span style="color:#F8960C;"><b>Thank you.</b></span>
    </div>

    <b>Counter-argument 2</b>
    <div class="pm-speech mb-4">
      They said that students will have more free time by abolishing homework.
      <span style="color:#cd5c5c;"><b>However, what students will do during free time is just playing games and chatting using SNS in most cases or just sleeping as they said.</b></span>
      <span style="color:#3169B3;"><b>It is because human is lazy in nature.
      Doing hard thing is usually difficult.
      Then, many students will not study at home.
      Of course, some students maybe study what they want to learn, however, the problem is for those kids who can’t study by themselves.</b></span>
      <span style="color:#6CBB5A;"><b>Imagine, elementary school students, they don’t know what study is important and how to do that.</b></span>
      <span style="color:#cd5c5c;"><b>That's why free time by abolishing homework is rather harmful to students.</b></span>
      <span style="color:#F8960C;"><b>Thank you.</b></span>
    </div>

    <h5><strong>Notes</strong></h5>
    <ul>
      <li>The beggining sentences, for example "They said that ...", are out of scope in this task, so they are NOT selectable</li>
      <li>If there is a summary sentence in the end, for example "That's why ...", please annotate as <span style="color:#cd5c5c;"><b>Claim</b></span></li>
    </ul>
  -->
    <!-- 以下 タスク画面 -->
    <hr style="height:1px;" class="mt-5 mb-5">
    <div>
      <h4><b>Topic: </b><!--${topic}--> Homework should be abolished.</h4>
    </div>
    <h5><b>Original argument</b></h5>
    <div class="pm-speech">
      We believe that if homework were to be abolished, we could have more free time. As a result, we could do more of what we really wanted like club activities, hobbies, or playing with friends.In my case, I go to tennis club after class until 5:00 pm and then I go to cram school until 8:00 pm. After this full day, I arrive at my home around 8:40 pm to eat dinner and take a shower. At nearly 10:00 pm I start my homework. I have a lot of homework. As a result, I go to belate at night at nearly 1:00 am in the morning and I don’t have the opportunity to sleep for a long period of time. It is not healthy.
      <!--${pm_speech}-->
    </div>
    <h5><b>Counter-argument</b></h5>
    <!-- テーブル作成 ID, Speaker, Speech-->
    <table border="1" style="width: 100%;" id="table_lo">
      <tbody>
        <!-- row1 -->
        <tr>
          <td align="center" style="width: 5%;; background-color: rgb(0, 0, 0);"> <span style="color: rgb(255, 255, 255);">ID</span> </td>
          <td align="center" style="width: 10%; background-color: rgb(0, 0, 0);"> <span style="color: rgb(255, 255, 255);">Speech</span> </td>
          <td align="center" style="width: 85%; background-color: rgb(0, 0, 0);"> <span style="color: rgb(255, 255, 255);">Claim ID</span> </td>
        </tr>
      </tbody>
    </table>

    <!-- ClaimType選択 3つのボタン -->
    <div class="mt-3 mb-2">
      <div class="mb-1">
        <button type="button" id="btn-stance" style="width:150px" class="btn-lg btn-sentence-stance">Stance</button>
        <span style="font-size:20px"> : statements that express agreement or disagreement with a topic</span>
      </div>
      <div class="mb-1">
        <button type="button" id="btn-claim" style="width:150px" class="btn-lg btn-sentence-claim">Claim</button>
        <span style="font-size:20px"> : central reason given in support of the debater's stance ( In general, there is one claim, at most two claims per speech )</span>
      </div>
      <div class="mb-1">
        <button type="button" id="btn-premise" style="width:150px" class="btn-lg btn-sentence-premise">Reason</button>
        <span style="font-size:20px"> : additional reasons that underpin the plausibility of the claim</span>
      </div>
      <div class="mb-1">
        <button type="button" id="btn-example" style="width:150px" class="btn-lg btn-sentence-example">Example</button>
        <span style="font-size:20px"> : personal experiences, hypothetical situations, statistics, and references in newspapers, etc.</span>
      </div>
      <div class="mb-1">
        <button type="button" id="btn-other" style="width:150px" class="btn-lg btn-sentence-other">Other</button>
        <span style="font-size:20px"> : greetings at the beginning and end</span>
      </div>
    </div>

    <!-- 'Clear', 'All Clear' の2つのボタン -->
    <div style="padding:5px 0 20px 0">
      <button type="button" id="btn-clear" class="btn-lg btn-secondary">Clear</button>
      <button type="button" id="btn-all-clear" class="btn-lg btn-secondary">All Clear</button>
    </div>
    <div>
      Any constructive feedback on this HIT is much welcome (optional)<br>
      <textarea id="feedback" name="feedback" style="width: 70%" rows="3"></textarea>
    </div>
    <div style="padding:20px 0 0 0">
      <div>
        <textarea name="Stance ID:"  class="uid-stance-text-area"></textarea>
        <textarea name="Claim ID:"  class="uid-claim-text-area"></textarea>
        <textarea name="Premise ID:"  class="uid-premise-text-area"></textarea>
        <textarea name="Example ID:"  class="uid-example-text-area"></textarea>
        <textarea name="Other ID:"  class="uid-other-text-area"></textarea>
      </div>
    </div>
    <div>
      <h5>
        <font color="red">We manually check each response and we will reject work if we notice anyone is trying to exploit the system, such as answer that clearly do not follow the instructions, etc.</font></b></h5>
      </h5>
      <h5>Thank you for working hard on this task!</h5>
    </div>
    <div id='lo_sentences' style='display:none'>${lo_sentences}</div>
    <div id='they_sentences' style='display:none'>${they_sentences}</div>
    <hr>
  </div>
</crowd-form>

<style type="text/css">
  .pm-speech{
  padding: 10px;
  margin-bottom: 10px;
  border: 1px
  dashed #333333;
  width:100%;
  }
  .btn-sentence{
  display: inline-block;
  padding: 5px 5px;
  border: solid 1px #FFFFFF;
  border-radius: 3px;
  color: #333;
  background: #FFFFFF;
  text-decoration: none;
  font-weight: normal;
  font-family: Helvetica, Arial, sans-serif;
  width: 100%;
  text-align: left;
  }
  .label-sentence{
  padding: 7px 5px;
  border-radius: 3px;
  color: #333;
  background: #FFFFFF;
  text-decoration: none;
  font-weight: normal;
  font-family: Helvetica, Arial, sans-serif;
  text-align: left;
  }
  .btn-sentence:hover{
  color: #FFFFFF;
  background: #CCCCCC;
  }
  .btn-sentence-selected{
  color: #FFFFFF;
  background: #BBBBBB !important;
  }
  .btn-sentence-stance{
  color: #FFFFFF;
  background: #C529A4;
  }
  .btn-sentence-claim{
  color: #FFFFFF;
  background: #cd5c5c;
  }
  .btn-sentence-premise{
  color: #FFFFFF;
  background: #3169B3;
  }
  .btn-sentence-example{
  color: #FFFFFF;
  background: #6CBB5A;
  }
  .btn-sentence-other{
  color: #FFFFFF;
  background: #F8960C;
  }
</style>

<script type="text/javascript">
  // 準備：LOスピーチを画面上に準備する．
  // １文単位でfor loop テーブルに出力
  $(function(){
    utterances = ("They said that homework robs us of our free time.\nHowever,Students have holidays and two long vacations in a year.\nThey are enough time to do our hobbies or play friends.\nWe can go trip in a vacation and play friends in holidays.\nAlso, We can talk with friends at break time in school.\nAnd besides, We may not have such a lot of homework and cram school everyday.\nStudents have a lot of free time than you think.\nAt least, they have more free time than adults.").split('\n');
    they_said_sentences = ("They said that homework robs us of our free time.").split('\n');

    utterances.forEach(function (value, index, array) {
      if(index < they_said_sentences.length){
        $('#table_lo').append(
        '<tr>' +
          '<td align="center" style="width: 5%;">' +
            index +
          '</td>' +
          '<td align="center" style="width: 80.0000%;" class="label-sentence">' +
            value +
          '</td>' +
          '<td>' +
            '<select id="reference_'+index+'" name="reference_'+index+'" style="width:100%; display:none;">' +
              '<option disabled selected value> -- select an ID -- </option>' +
            '</select>' +
          '</td>' +
        '</tr>');
      }else{
        $('#table_lo').append(
        '<tr>' +
          '<td align="center" style="width: 5%;">' +
            index +
          '</td>' +
          '<td align="center" style="width: 80.0000%;">' +
            '<button type="button" id="display_u'+index+'" class="btn-large btn-sentence">' +
              value +
            '</button>' +
          '</td>' +
          '<td>' +
            '<select id="reference_'+index+'" name="reference_'+index+'" style="width:100%; display:none;">' +
              '<option disabled selected value> -- select an ID -- </option>' +
            '</select>' +
          '</td>' +
        '</tr>');
      }
    })

    const utterances_length = utterances.length;


    // --- 以下処理内容 ---
    $('[id^=display]').click(function(){
      $(this).toggleClass('btn-sentence-selected');
    })

    function remove_utterance_from_text_area(text_area_name, utterance_id){
      text_area_value = $(text_area_name).val();
      if(text_area_value){
        utterance_ids = text_area_value.split('\n');
        for(i = 0; i < utterance_ids.length; i++){
          if(utterance_ids[i] == utterance_id){
            utterance_ids.splice(i, 1);
          };
        };
        $(text_area_name).val(utterance_ids.join('\n'));
      };
    }

    function remove_utterance_from_all_text_area(utterance_id){
      remove_utterance_from_text_area('.uid-stance-text-area', utterance_id);
      remove_utterance_from_text_area('.uid-claim-text-area', utterance_id);
      remove_utterance_from_text_area('.uid-premise-text-area', utterance_id);
      remove_utterance_from_text_area('.uid-example-text-area', utterance_id);
      remove_utterance_from_text_area('.uid-other-text-area', utterance_id)
    }

    function remove_all_utterances(){
      $('.uid-stance-text-area').val('');
      $('.uid-claim-text-area').val('');
      $('.uid-premise-text-area').val('');
      $('.uid-example-text-area').val('');
      $('.uid-other-text-area').val('');
    }

    function add_utterance_id(type){
      text_area_value = $(".uid-"+type+"-text-area").val('');
      type_array = [type]
      utterance_ids_array = get_utterances_ids(type_array);
      $(".uid-"+type+"-text-area").val(utterance_ids_array.join('\n'));
    }

    function get_utterances_ids(type_array){
      // type_array = ['claim-value', 'claim-fact', 'claim-policy', 'restatement']
      utterance_ids_array = [];
      for (let idx in type_array){
        cs = document.getElementsByClassName('btn-sentence btn-sentence-'+type_array[idx]);
        for (var i=0; i< cs.length;i++){
          idd = cs[i].getAttribute("id");
          utterance_id = extract_utterance_id(idd);
          utterance_ids_array.push(utterance_id);
        };
      };
      utterance_ids_array.sort();
      return utterance_ids_array;
    }

    function clear_selected_state(index, element){
      $(element).removeClass(function (index, className) {
        return (className.match (/(^|\s)btn-sentence-\S+/g) || []).join(' ');
      });
    }

    function extract_utterance_id(btn_id){
      return btn_id.match(/.+_u(.+)/)[1];
    }

    function clear_drop_down_btn(utterances_length){
      for (let i=0; i<utterances_length; i++){
        $('#reference_'+i).prop('required',false);
        $('select#reference_'+i+' option').remove();
        $('#reference_'+i).append($('<option disabled selected value>').html(' -- select an ID -- '));
      };
    }

    function add_or_clear_drop_down_option(utterances_length, index){
      for (let i=0; i<utterances_length; i++){
        if($("#display_u"+i).hasClass("btn-sentence-premise") || $("#display_u"+i).hasClass("btn-sentence-example")){
          var exists = false;
          $('#reference_'+i+' option').each(function(){
            if (this.value == index) {
              exists = true;
            }
          });
          if (exists){
            continue;
          }
          $('#reference_'+i).prop('required',true);
          $('#reference_'+i).append($('<option>').html(index));
        }
        else{
          $('#reference_'+i).prop('required',false);
          $('select#reference_'+i+' option').remove();
          $('#reference_'+i).append($('<option disabled selected value>').html(' -- select an ID -- '));
        };
      };
      $('#reference_'+index).hide();
    }


    function check_number_of_claim(max_number=3){
      var x = 0;
      var y = 0;
      var z = 0;
      $('[id^=display_u]').each(function(index, element){
        if($(this).hasClass('btn-sentence-selected') && ($(this).hasClass('btn-sentence-claim'))){
          x += 1
          //console.log("x");
        }
        else if ($(this).hasClass('btn-sentence-selected')) {
          y += 1
          //console.log('y');
        }
        else if ($(this).hasClass('btn-sentence-claim')){
          z += 1
          //console.log('z');
        }
      });
      sum = x + y + z;
      return sum <= max_number
    }

    // --- 以下ボタン押した時の処理 ---
    // stance btn
    $('[id^=btn-stance]').click(function(){
      $("[id^=display_u]").each(function(index, element){
        if($(this).hasClass("btn-sentence-selected")){
          var utterance_id = extract_utterance_id($(this).attr("id"));
          clear_selected_state(utterance_id, element);
          $(element).addClass('btn-sentence-stance');
          remove_utterance_from_all_text_area(utterance_id);
          $('#reference_'+utterance_id).prop('required',false);
          $('select#reference_'+utterance_id+' option').remove();
          $('#reference_'+utterance_id).append($('<option disabled selected value>').html(' -- select an ID -- '));
          $('#reference_'+utterance_id).hide();
          claim_type_array = ['claim'];
          claim_ids_array = get_utterances_ids(claim_type_array);
          clear_drop_down_btn(utterances_length);
          for (let j in claim_ids_array){
            add_or_clear_drop_down_option(utterances_length, claim_ids_array[j]);
          };
          add_utterance_id('stance');
        };
      });
    })

    // claim btn
    $('[id^=btn-claim]').click(function(){
      if(check_number_of_claim()){
        $("[id^=display_u]").each(function(index, element){
          if($(this).hasClass("btn-sentence-selected")){
            var utterance_id = extract_utterance_id($(this).attr("id"));
            clear_selected_state(utterance_id, element);
            $(element).addClass('btn-sentence-claim');
            remove_utterance_from_all_text_area(utterance_id);
            add_or_clear_drop_down_option(utterances_length, utterance_id);
            add_utterance_id('claim');
          };
        });
      }else {
        alert("Can't select more than 3 claims.");
      };
    })

    // premise btn
    $('[id^=btn-premise]').click(function(){
      $("[id^=display_u]").each(function(index, element){
        if($(this).hasClass("btn-sentence-selected")){
          var utterance_id = extract_utterance_id($(this).attr("id"));
          clear_selected_state(utterance_id, element);
          $(element).addClass('btn-sentence-premise');
          remove_utterance_from_all_text_area(utterance_id);
          add_utterance_id('premise');
          // リステイトメント先プルダウン表示, 要素追加
          clear_drop_down_btn(utterances_length);
          $('#reference_'+utterance_id).prop('required',true);
          $('#reference_'+utterance_id).show();
          claim_type_array = ['claim'];
          claim_ids_array = get_utterances_ids(claim_type_array);
          for (let j in claim_ids_array){
            add_or_clear_drop_down_option(utterances_length, claim_ids_array[j]);
          };

        };
      });
    })

    // example btn
    $('[id^=btn-example]').click(function(){
      $("[id^=display_u]").each(function(index, element){
        if($(this).hasClass("btn-sentence-selected")){
          var utterance_id = extract_utterance_id($(this).attr("id"));
          clear_selected_state(utterance_id, element);
          $(element).addClass('btn-sentence-example');
          remove_utterance_from_all_text_area(utterance_id);
          add_utterance_id('example');
          // リステイトメント先プルダウン表示, 要素追加
          clear_drop_down_btn(utterances_length);
          $('#reference_'+utterance_id).prop('required',true);
          $('#reference_'+utterance_id).show();
          claim_type_array = ['claim'];
          claim_ids_array = get_utterances_ids(claim_type_array);
          for (let j in claim_ids_array){
            add_or_clear_drop_down_option(utterances_length, claim_ids_array[j]);
          };

        };
      });
    })

    // other btn
    $('[id^=btn-other]').click(function(){
      $("[id^=display_u]").each(function(index, element){
        if($(this).hasClass("btn-sentence-selected")){
          var utterance_id = extract_utterance_id($(this).attr("id"));
          clear_selected_state(utterance_id, element);
          $(element).addClass('btn-sentence-other');
          remove_utterance_from_all_text_area(utterance_id);
          $('#reference_'+utterance_id).prop('required',false);
          $('select#reference_'+i+' option').remove();
          $('#reference_'+utterance_id).append($('<option disabled selected value>').html(' -- select an ID -- '));
          $('#reference_'+utterance_id).hide();
          claim_type_array = ['claim'];
          claim_ids_array = get_utterances_ids(claim_type_array);
          clear_drop_down_btn(utterances_length);
          for (let j in claim_ids_array){
            add_or_clear_drop_down_option(utterances_length, claim_ids_array[j]);
          };
          add_utterance_id('other');
        };
      });
    })

    // clear btn
    $('[id^=btn-clear]').click(function(){
      $("[id^=display_u]").each(function(index, element){
        if($(this).hasClass("btn-sentence-selected")){
          var utterance_id = extract_utterance_id($(this).attr("id"));
          clear_selected_state(utterance_id, element);
          // リステイトメント先プルダウン非表示
          $('#reference_'+utterance_id).hide();
          //clear_drop_down_btn(utterances_length);
          remove_utterance_from_all_text_area(utterance_id);
        };
      });
    })

    // all-clear btn
    $('[id^=btn-all-clear]').click(function(){
      $("[id^=display_u]").each(function(index, element){
        var utterance_id = extract_utterance_id($(this).attr("id"));
        clear_selected_state(utterance_id, element);
        // リステイトメント先プルダウン非表示
        $('#reference_'+utterance_id).hide();
        clear_drop_down_btn(utterances_length);
        remove_all_utterances();
      });
    })

    // 提出時のエラー
    document.querySelector('crowd-form').onsubmit = function(e ) {
      claim_text = $('.uid-claim-text-area').val();
      premise_text = $('.uid-premise-text-area').val();
      example_text = $('.uid-example-text-area').val();
      other_text = $('.uid-other-text-area').val();

      claim_text_len = claim_text.split('\n').length;
      premise_text_len = premise_text.split('\n').length;
      example_text_len = example_text.split('\n').length;
      other_text_len = other_text.split('\n').length;

      if (stance_text=="" && claim_text=="" && premise_text=="" && example_text=="" && other_text==""){
        console.log('test error');
        alert("Please select type at least one.")
        e.preventDefault();
      }else if (claim_text_len + premise_text_len + example_text_len + other_text_len + they_said_sentences.length != utterances_length) {
        console.log('test error2');
        alert("Please select all setnence.")
        e.preventDefault();
      };
    }
  })
</script>
